{"ast":null,"code":"import _regeneratorRuntime from\"F:/sunshine-full-project/agustine-hotel--main/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"F:/sunshine-full-project/agustine-hotel--main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"F:/sunshine-full-project/agustine-hotel--main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{CardElement,useElements,useStripe}from\"@stripe/react-stripe-js\";import React,{useEffect}from\"react\";import{useContext}from\"react\";import{useState}from\"react\";import toast from\"react-hot-toast\";import{useNavigate}from\"react-router-dom\";import{AuthContext}from\"../../Context/AuthContext/UserContext\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CheckOutForm=function CheckOutForm(_ref){var roomDetails=_ref.roomDetails,checkOutDate=_ref.checkOutDate,checkindate=_ref.checkindate;var stripe=useStripe();var navigate=useNavigate();var elements=useElements();var _useContext=useContext(AuthContext),user=_useContext.user;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),transactionID=_useState2[0],setTransactionID=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),success=_useState4[0],setSuccess=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),cardError=_useState6[0],setCardError=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),proccessing=_useState8[0],setProccessing=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];// const { price, Patientname, Patientemail, _id } = booking;\nvar price=roomDetails.price,_id=roomDetails._id;useEffect(function(){fetch(\"https://hotel-web-server.vercel.app/create-payment-intent\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",authorization:\"Bearer \".concat(localStorage.getItem('accesToken'))},body:JSON.stringify({price:price})}).then(function(res){return res.json();}).then(function(data){return setClientSecret(data.clientSecret);});},[price]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var card,_yield$stripe$createP,error,paymentMethod,_yield$stripe$confirm,paymentIntent,confirmError,paidRoom;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(!(!stripe||!elements||proccessing)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:card=elements.getElement(CardElement);if(!(card===null)){_context.next=6;break;}return _context.abrupt(\"return\");case 6:_context.next=8;return stripe.createPaymentMethod({type:\"card\",card:card});case 8:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(error){console.log(error);setCardError(error.message);}else{setCardError(\"\");}setSuccess('');setProccessing(true);_context.next=16;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:card,billing_details:{email:user===null||user===void 0?void 0:user.email}}});case 16:_yield$stripe$confirm=_context.sent;paymentIntent=_yield$stripe$confirm.paymentIntent;confirmError=_yield$stripe$confirm.error;if(confirmError){setCardError(confirmError.message);}if(paymentIntent.status==='succeeded'){setSuccess('Congrats Your Payment is Done');setTransactionID(paymentIntent.id);setProccessing(false);toast.success('Payment Success');navigate('/dashboard');// const payment = {\n//     email: user?.email,\n//     transactionID: paymentIntent.id,\n//     price,\n//     bookingID: _id\n// }\npaidRoom={checkin:checkindate,checkout:checkOutDate,transactionID:paymentIntent.id,email:user.email,price:price,bookingID:_id};fetch('https://hotel-web-server.vercel.app/payments',{method:'POST',headers:{'content-type':\"application/json\",authorization:\"bearer \".concat(localStorage.getItem('accessToken'))},body:JSON.stringify(paidRoom)}).then(function(res){return res.json();}).then(function(data){console.log(data);});}case 21:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{options:{style:{base:{fontSize:\"16px\",color:\"#424770\",\"::placeholder\":{color:\"#aab7c4\"}},invalid:{color:\"#9e2146\"}}}}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500\",children:cardError}),/*#__PURE__*/_jsx(\"button\",{className:\"btn bg-slate-200 text-slate-700 btn-sm my-4\",type:\"submit\",disabled:!stripe||!clientSecret,children:\"Pay\"})]}),success&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-green-500\",children:success}),/*#__PURE__*/_jsx(\"p\",{className:\"\",children:transactionID})]})]});};export default CheckOutForm;","map":{"version":3,"names":["CardElement","useElements","useStripe","React","useEffect","useContext","useState","toast","useNavigate","AuthContext","CheckOutForm","roomDetails","checkOutDate","checkindate","stripe","navigate","elements","user","transactionID","setTransactionID","success","setSuccess","cardError","setCardError","proccessing","setProccessing","clientSecret","setClientSecret","price","_id","fetch","method","headers","authorization","localStorage","getItem","body","JSON","stringify","then","res","json","data","handleSubmit","event","preventDefault","card","getElement","createPaymentMethod","type","error","paymentMethod","console","log","message","confirmCardPayment","payment_method","billing_details","email","paymentIntent","confirmError","status","id","paidRoom","checkin","checkout","bookingID","style","base","fontSize","color","invalid"],"sources":["F:/sunshine-full-project/agustine-hotel--main/src/Components/Book/CheckOutForm.js"],"sourcesContent":["import { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport React, { useEffect } from \"react\";\nimport { useContext } from \"react\";\nimport { useState } from \"react\";\nimport toast from \"react-hot-toast\";\nimport { useNavigate } from \"react-router-dom\";\nimport { AuthContext } from \"../../Context/AuthContext/UserContext\";\n\n\n\nconst CheckOutForm = ({ roomDetails,checkOutDate,checkindate  }) => {\n    const stripe = useStripe();\n    const navigate = useNavigate()\n    const elements = useElements();\n    const { user } = useContext(AuthContext)\n    const [transactionID, setTransactionID] = useState(\"\");\n    const [success, setSuccess] = useState(\"\");\n    const [cardError, setCardError] = useState(\"\");\n    const [proccessing, setProccessing] = useState(false);\n    const [clientSecret, setClientSecret] = useState(\"\");\n\n    // const { price, Patientname, Patientemail, _id } = booking;\n    const { price, _id } = roomDetails;\n\n    useEffect(() => {\n        fetch(\"https://hotel-web-server.vercel.app/create-payment-intent\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                authorization: `Bearer ${localStorage.getItem('accesToken')}`\n            },\n            body: JSON.stringify({ price }),\n        })\n            .then(res => res.json())\n            .then(data => setClientSecret(data.clientSecret));\n    }, [price]);\n\n    const handleSubmit = async event => {\n        event.preventDefault();\n        if (!stripe || !elements || proccessing) {\n            return;\n        }\n        const card = elements.getElement(CardElement);\n        if (card === null) {\n            return;\n        }\n\n        const { error, paymentMethod } = await stripe.createPaymentMethod({\n            type: \"card\",\n            card,\n        });\n\n        if (error) {\n            console.log(error);\n            setCardError(error.message);\n        } else {\n            setCardError(\"\");\n        }\n        setSuccess('')\n        setProccessing(true)\n        const { paymentIntent, error: confirmError } = await stripe.confirmCardPayment(\n            clientSecret,\n            {\n                payment_method: {\n                    card: card,\n                    billing_details: {\n                       \n                        email: user?.email,\n                    },\n                },\n            },\n        );\n\n        if (confirmError) {\n            setCardError(confirmError.message)\n        }\n        if (paymentIntent.status === 'succeeded') {\n            setSuccess('Congrats Your Payment is Done')\n            setTransactionID(paymentIntent.id)\n            setProccessing(false)\n            toast.success('Payment Success')\n            navigate('/dashboard')\n            // const payment = {\n            //     email: user?.email,\n            //     transactionID: paymentIntent.id,\n            //     price,\n            //     bookingID: _id\n\n            // }\n            const paidRoom = {\n                checkin: checkindate,\n                checkout: checkOutDate,\n                transactionID: paymentIntent.id,\n                email: user.email,\n                price,\n                bookingID: _id\n               \n            }\n\n            fetch('https://hotel-web-server.vercel.app/payments', {\n                method: 'POST',\n                headers: {\n                    'content-type': \"application/json\",\n                    authorization: `bearer ${localStorage.getItem('accessToken')}`\n                },\n                body: JSON.stringify(paidRoom)\n            })\n                .then(res => res.json())\n                .then(data => {\n                    console.log(data);\n                })\n\n        }\n\n    };\n\n    return (\n        <div>\n            <form onSubmit={handleSubmit}>\n                <CardElement\n                    options={{\n                        style: {\n                            base: {\n                                fontSize: \"16px\",\n                                color: \"#424770\",\n                                \"::placeholder\": {\n                                    color: \"#aab7c4\",\n                                },\n                            },\n                            invalid: {\n                                color: \"#9e2146\",\n                            },\n                        },\n                    }}\n                />\n                <p className=\"text-red-500\">{cardError}</p>\n                <button\n                    className=\"btn bg-slate-200 text-slate-700 btn-sm my-4\"\n                    type=\"submit\"\n                    disabled={!stripe || !clientSecret}\n                >\n                    Pay\n                </button>\n            </form>\n            {\n                success && <div>\n                    <p className=\"text-green-500\">{success}</p>\n                    <p className=\"\">{transactionID}</p>\n                </div>\n            }\n        </div>\n    );\n};\n\nexport default CheckOutForm;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}